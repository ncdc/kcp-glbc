# Code generated by dhall-to-yaml.  DO NOT EDIT.
groups:
  - name: deadmanssnitch
    rules:
      - alert: DeadMansSwitch
        annotations:
          description: |2
              This is an alert meant to ensure that the entire alerting pipeline
              is functional.
              This alert is always firing, therefore it should always be firing
              in Alertmanager
              and always fire against a receiver. There are integrations with
              various notification
              mechanisms that send a notification when this alert is not firing.
              For example the
              "DeadMansSnitch" integration in PagerDuty.
        expr: "vector(1)"
        labels:
          name: DeadMansSwitchAlert
  - name: glbc
    rules:
      - alert: CertManagerDown
        annotations:
          description: "Cert-Manager is down. Either Cert-Manager is not running and failing to become ready, is misconfigured, or the metrics endpoint is not responding."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/CertManagerDown.adoc
          summary: Cert-Manager is down
        expr: "(1-absent(kube_pod_status_ready{pod=~\"cert-manager.*\",condition=\"true\"})) or kube_pod_status_ready{pod=~\"cert-manager.*\",condition=\"true\"} < 1"
        for: "5m"
        labels:
          severity: critical
      - alert: GLBCTargetDown
        annotations:
          description: "The GLBC Prometheus Target is down. Either the GLBC component is not running, is misconfigured, or the metrics endpoint is not responding."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/glbctargetdown.adoc
          summary: GLBC Prometheus Target is down
        expr: "absent(up{container=\"manager\",job=~\".*kcp-glbc-controller-manager\"}) or up{container=\"manager\",job=~\".*kcp-glbc-controller-manager\"} != 1"
        for: "5m"
        labels:
          severity: critical
      - alert: HighDNSLatencyAlert
        annotations:
          description: "High latency rate when requesting DNS - The latency rate is {{ $value }} seconds, which is greater than our threshold which is 0.5seconds."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/HighDNSLatencyAlert.adoc
          summary: High DNS Latency Rate Alert
        expr: "sum(rate(glbc_aws_route53_request_duration_seconds_sum[5m])) / sum(rate(glbc_aws_route53_request_duration_seconds_count[5m])) > 0.5"
        for: "60m"
        labels:
          severity: warning
      - alert: HighDNSProviderErrorRate
        annotations:
          description: "Excessive errors - The error rate is {{ $value }}, which is greater than the threshold which is 1%"
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/HighDNSProviderErrorRate.adoc
          summary: High DNS Provider Error Rate
        expr: "sum(rate(glbc_aws_route53_request_errors_total{}[5m])) by(pod) / sum(rate(glbc_aws_route53_request_total{}[5m])) by(pod) > 0.01"
        for: "60m"
        labels:
          severity: warning
      - alert: HighTLSProviderErrorRate
        annotations:
          description: "Excessive errors - The error rate is {{ $value }}, which is greater than the threshold which is 1%"
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/HighTLSProviderErrorRate.adoc
          summary: High TLS Provider Error Rate
        expr: "sum(rate(glbc_tls_certificate_request_errors_total{}[5m])) by(pod) / sum(rate(glbc_tls_certificate_request_total{}[5m])) by(pod) > 0.01"
        for: "60m"
        labels:
          severity: warning
      - alert: HighTLSProviderLatencyAlert
        annotations:
          description: "High latency rate when requesting TLS - The latency rate is {{ $value }} seconds, which is greater than our threshold which is 120 seconds."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/HighTLSProviderLatencyAlert.adoc
          summary: High TLS Latency Rate Alert
        expr: "sum(rate(glbc_tls_certificate_issuance_duration_seconds_sum[5m])) / sum(rate(glbc_tls_certificate_issuance_duration_seconds_count[5m])) > 120"
        for: "60m"
        labels:
          severity: warning
  - name: SLOIngressAdmissionLatency
    rules:
      - alert: SLOIngressAdmissionLatency-ErrorBudgetBurn-5m1h
        annotations:
          description: "High error budget burn in namespace {{ $labels.namespace }} (current value: {{ $value }}). Check the runbook for how to resolve this."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/SLOIngressAdmissionLatency.adoc
          summary: "At least 2.0% of the SLO error budget has been consumed over the past 5m and 1h windows"
        expr: |
          (
            glbc_ingress_managed_object_time_to_admission:burnrate5m{container="manager",job=~".*kcp-glbc-controller-manager"} > (13.44 * (1-0.999))
            and
            glbc_ingress_managed_object_time_to_admission:burnrate1h{container="manager",job=~".*kcp-glbc-controller-manager"} > (13.44 * (1-0.999))
          )
        labels:
          severity: critical
      - alert: SLOIngressAdmissionLatency-ErrorBudgetBurn-30m6h
        annotations:
          description: "High error budget burn in namespace {{ $labels.namespace }} (current value: {{ $value }}). Check the runbook for how to resolve this."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/SLOIngressAdmissionLatency.adoc
          summary: "At least 5.0% of the SLO error budget has been consumed over the past 30m and 6h windows"
        expr: |
          (
            glbc_ingress_managed_object_time_to_admission:burnrate30m{container="manager",job=~".*kcp-glbc-controller-manager"} > (5.6 * (1-0.999))
            and
            glbc_ingress_managed_object_time_to_admission:burnrate6h{container="manager",job=~".*kcp-glbc-controller-manager"} > (5.6 * (1-0.999))
          )
        labels:
          severity: critical
      - alert: SLOIngressAdmissionLatency-ErrorBudgetBurn-2h1d
        annotations:
          description: "High error budget burn in namespace {{ $labels.namespace }} (current value: {{ $value }}). Check the runbook for how to resolve this."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/SLOIngressAdmissionLatency.adoc
          summary: "At least 10.0% of the SLO error budget has been consumed over the past 2h and 1d windows"
        expr: |
          (
            glbc_ingress_managed_object_time_to_admission:burnrate2h{container="manager",job=~".*kcp-glbc-controller-manager"} > (2.8 * (1-0.999))
            and
            glbc_ingress_managed_object_time_to_admission:burnrate1d{container="manager",job=~".*kcp-glbc-controller-manager"} > (2.8 * (1-0.999))
          )
        labels:
          severity: warning
      - alert: SLOIngressAdmissionLatency-ErrorBudgetBurn-6h3d
        annotations:
          description: "High error budget burn in namespace {{ $labels.namespace }} (current value: {{ $value }}). Check the runbook for how to resolve this."
          runbook_url: https://github.com/Kuadrant/kcp-glbc/blob/main/docs/observability/runbooks/SLOIngressAdmissionLatency.adoc
          summary: "At least 10.0% of the SLO error budget has been consumed over the past 6h and 3d windows"
        expr: |
          (
            glbc_ingress_managed_object_time_to_admission:burnrate6h{container="manager",job=~".*kcp-glbc-controller-manager"} > (0.933 * (1-0.999))
            and
            glbc_ingress_managed_object_time_to_admission:burnrate3d{container="manager",job=~".*kcp-glbc-controller-manager"} > (0.933 * (1-0.999))
          )
        labels:
          severity: warning
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[5m]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[5m]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate5m
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[30m]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[30m]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate30m
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[2h]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[2h]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate2h
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[6h]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[6h]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate6h
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[1h]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[1h]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate1h
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[6h]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[6h]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate6h
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[1d]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[1d]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate1d
      - expr: |
          1 - (
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_bucket{container="manager",job=~".*kcp-glbc-controller-manager",le="120"}[3d]))
            /
            sum by(container,job,namespace) (rate(glbc_ingress_managed_object_time_to_admission_count{container="manager",job=~".*kcp-glbc-controller-manager"}[3d]))
          )
        record: glbc_ingress_managed_object_time_to_admission:burnrate3d
